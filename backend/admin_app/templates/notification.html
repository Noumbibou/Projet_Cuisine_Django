{% extends 'base/dashboard.html' %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4">Notifications</h2>
    {% if notifications %}
        <ul class="list-group">
            {% for notification in notifications %}
                <li class="list-group-item d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-2" data-id="{{ notification.id }}">
                    <div>
                        <strong>
                            {% if notification.utilisateur %}
                                {{ notification.utilisateur.email }}
                            {% else %}
                                Utilisateur inconnu
                            {% endif %}
                        </strong>
                        <br>
                        <span>{{ notification.message }}</span>
                    </div>
                    <small class="text-muted mt-2 mt-md-0">
                        {{ notification.date_creation|date:"d/m/Y H:i" }}
                        {% if not notification.lu %}
                            <span class="badge bg-info text-dark ms-2 badge-lu" style="cursor:pointer;" data-id="{{ notification.id }}">Non lu</span>
                        {% else %}
                            <span class="badge bg-success text-light ms-2">Lu</span>
                        {% endif %}
                    </small>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <div class="alert alert-info">Aucune notification.</div>
    {% endif %}
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.badge-lu').forEach(function(badge) {
        badge.addEventListener('click', function() {
            const notifId = badge.dataset.id;
            fetch('/admin_app/notification_lu/' + notifId + '/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            }).then(response => response.json()).then(data => {
                if (data.success) {
                    badge.textContent = 'Lu';
                    badge.classList.remove('bg-info', 'text-dark');
                    badge.classList.add('bg-success', 'text-light');
                    badge.style.cursor = 'default';
                    badge.removeAttribute('data-id');
                }
            });
        });
    });
});
</script>
{% endblock %}